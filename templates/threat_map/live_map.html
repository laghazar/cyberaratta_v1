{% extends 'base.html' %}
{% load static %}

{% block title %}üìå ’è’•’≠’∂’´’Ø’°’Ø’°’∂ ’°’º’°’ª’°’§÷Ä’°’∂÷Ñ - ‘ø’´’¢’•’º ’Ω’∫’°’º’∂’°’¨’´÷Ñ’∂’•÷Ä’´ LIVE ÷Ñ’°÷Ä’ø’•’¶{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
      crossorigin=""/>
<link rel="stylesheet" href="{% static 'css/live-map.css' %}">
{% endblock %}

{% block content %}
<div class="live-map-container">
    <!-- Header -->
    <div class="live-map-header">
        <div class="container">
            <h1 class="map-title">
                üá¶üá≤ ’Ä’°’µ’°’Ω’ø’°’∂’´ ’§’•’¥ ’∏÷Ç’≤’≤’æ’°’Æ ’Ø’´’¢’•’º ’Ω’∫’°’º’∂’°’¨’´÷Ñ’∂’•÷Ä
                <span class="live-indicator">üî¥ LIVE</span>
            </h1>
            <p class="map-subtitle">
                ‘ª÷Ä’°’Ø’°’∂ ’™’°’¥’°’∂’°’Ø’∏÷Ç’¥ ’Ø’´’¢’•’º’∞’°÷Ä’±’°’Ø’∏÷Ç’¥’∂’•÷Ä’´ ’°’∑’≠’°÷Ä’∞’°’£÷Ä’°’Ø’°’∂ ÷Å’∏÷Ç÷Å’°’§÷Ä’∏÷Ç’¥
            </p>
        </div>
    </div>

    <!-- Map Container -->
    <div class="map-wrapper">
        <div id="cyber-threat-map" class="threat-map"></div>
        
        <!-- Map Controls -->
        <div class="map-controls">
            <div class="control-panel">
                <h3>üéõÔ∏è ‘ø’°’º’°’æ’°÷Ä’∏÷Ç’¥</h3>
                <div class="control-group">
                    <label class="control-label">
                        <input type="checkbox" id="showAttackLines" checked>
                        <span>’ë’∏÷Ç’µ÷Å ’ø’°’¨ ’∞’°÷Ä’±’°’Ø’¥’°’∂ ’£’Æ’•÷Ä</span>
                    </label>
                    <label class="control-label">
                        <input type="checkbox" id="showSourceMarkers" checked>
                        <span>’ë’∏÷Ç’µ÷Å ’ø’°’¨ ’°’≤’¢’µ’∏÷Ç÷Ä ’•÷Ä’Ø÷Ä’∂’•÷Ä’®</span>
                    </label>
                    <label class="control-label">
                        <input type="checkbox" id="autoRefresh" checked>
                        <span>‘±’æ’ø’∏’¥’°’ø ’©’°÷Ä’¥’°÷Å’∏÷Ç’¥ (30’æ)</span>
                    </label>
                </div>
                
                <div class="refresh-controls">
                    <button id="manualRefresh" class="btn-refresh">
                        üîÑ ‘π’°÷Ä’¥’°÷Å’∂’•’¨ ’∞’´’¥’°
                    </button>
                    <div class="next-refresh">
                        ’Ä’°’ª’∏÷Ä’§ ’©’°÷Ä’¥’°÷Å’∏÷Ç’¥’®: <span id="nextRefreshTime">30’æ</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Panel -->
        <div class="stats-panel">
            <h3>üìä ’é’´’≥’°’Ø’°’£÷Ä’∏÷Ç’©’µ’∏÷Ç’∂</h3>
            <div class="stat-item">
                <span class="stat-label">‘∏’∂’§’∞’°’∂’∏÷Ç÷Ä ’∞’°÷Ä’±’°’Ø’∏÷Ç’¥’∂’•÷Ä:</span>
                <span class="stat-value" id="totalAttacks">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">’é’•÷Ä’ª’´’∂ 5 ÷Ä’∏’∫’•’∏÷Ç’¥:</span>
                <span class="stat-value" id="recentAttacks">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">‘±’Ø’ø’´’æ ’°’≤’¢’µ’∏÷Ç÷Ä ’•÷Ä’Ø÷Ä’∂’•÷Ä:</span>
                <span class="stat-value" id="sourceCountries">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">’é’ø’°’∂’£’°’æ’∏÷Ä’∏÷Ç’©’µ’∏÷Ç’∂:</span>
                <span class="threat-level" id="threatLevel">’ë‘±‘æ’ê</span>
            </div>
        </div>

        <!-- Attack Log -->
        <div class="attack-log">
            <h3>üìã ’é’•÷Ä’ª’´’∂ ’∞’°÷Ä’±’°’Ø’∏÷Ç’¥’∂’•÷Ä</h3>
            <div class="log-container" id="attackLogContainer">
                <div class="log-item loading">
                    ‚è≥ ’è’æ’µ’°’¨’∂’•÷Ä’´ ’¢’•’º’∂’∏÷Ç’¥...
                </div>
            </div>
        </div>
    </div>

    <!-- Legend -->
    <div class="map-legend">
        <h4>üó∫Ô∏è ‘æ’°’∂’∏÷Ç÷Å’°’Ø’∂’•÷Ä</h4>
        <div class="legend-items">
            <div class="legend-item">
                <span class="legend-icon armenia-marker">üá¶üá≤</span>
                <span>’Ä’°’µ’°’Ω’ø’°’∂ (’©’´÷Ä’°’≠)</span>
            </div>
            <div class="legend-item">
                <span class="legend-icon source-marker">üî¥</span>
                <span>‘±’≤’¢’µ’∏÷Ç÷Ä ’•÷Ä’Ø’´÷Ä</span>
            </div>
            <div class="legend-item">
                <span class="legend-icon attack-line">‚îÅ‚îÅ‚îÅ‚îÅ</span>
                <span>’Ä’°÷Ä’±’°’Ø’¥’°’∂ ’∏÷Ç’≤’≤’∏÷Ç’©’µ’∏÷Ç’∂</span>
            </div>
            <div class="legend-item">
                <span class="legend-icon high-threat">‚ö°</span>
                <span>‘≤’°÷Ä’±÷Ä ’æ’ø’°’∂’£’°’æ’∏÷Ä’∏÷Ç’©’µ’∏÷Ç’∂</span>
            </div>
        </div>
    </div>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay">
    <div class="loading-content">
        <div class="loading-spinner"></div>
        <h3>üåê ’è’æ’µ’°’¨’∂’•÷Ä’´ ’¢’•’º’∂’∏÷Ç’¥...</h3>
        <p>’ç’ø’°÷Å’æ’∏÷Ç’¥ ’•’∂ ’æ’•÷Ä’ª’´’∂ ’Ø’´’¢’•’º ’Ω’∫’°’º’∂’°’¨’´÷Ñ’∂’•÷Ä’´ ’ø’æ’µ’°’¨’∂’•÷Ä’®</p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
        crossorigin=""></script>
<script src="{% static 'js/live-threat-map.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Initializing Live Threat Map...');
    
    // Initialize the live threat map
    window.threatMap = new LiveThreatMap('cyber-threat-map');
    window.threatMap.initialize().catch(error => {
        console.error('‚ùå Failed to initialize threat map:', error);
        alert('’â’∞’°’ª’∏’≤’æ’•÷Å ’¢’•’º’∂’•’¨ ’Ω’∫’°’º’∂’°’¨’´÷Ñ’∂’•÷Ä’´ ÷Ñ’°÷Ä’ø’•’¶’®');
    });
});

// Add CSS animations for attack lines and markers
const style = document.createElement('style');
style.textContent = `
    @keyframes markerPulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.2); opacity: 0.7; }
    }
    
    .attack-line-animated {
        animation: attackLineDash 3s linear infinite;
    }
    
    @keyframes attackLineDash {
        0% { stroke-dashoffset: 0; }
        100% { stroke-dashoffset: -30; }
    }
    
    .custom-source-marker {
        z-index: 1000;
    }
    
    .armenia-marker-custom {
        z-index: 1001;
    }
`;
document.head.appendChild(style);
</script>
{% endblock %}
