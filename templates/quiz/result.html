{% extends 'base.html' %}
{% load static %}
{% load quiz_extras %}
{% block title %}Քուիզի Արդյունք{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/quiz.css' %}">
<link rel="stylesheet" href="{% static 'css/quiz-theme.css' %}">
{% endblock %}

{% block content %}
<div class="armenian-pattern"></div>
<div class="container py-5">
    <div class="quiz-result-container">
        <div class="result-header text-center mb-5">
            <h1 class="display-4">Քուիզն Ավարտված է</h1>
            <p class="lead text-muted">Շնորհակալություն մասնակցության համար</p>
            <div class="divider my-4">
                <div class="divider-line"></div>
                <div class="divider-icon"><i class="fas fa-award"></i></div>
                <div class="divider-line"></div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="result-card card shadow-lg fade-in">
                    <div class="card-body p-0">
                        <div class="result-header-banner p-4 text-center text-white 
                            {% if result.percentage >= 70 %}bg-success{% else %}bg-warning{% endif %}">
                            <h2 class="mb-0">{{ result.percentage }}% ճիշտ</h2>
                            <p class="mb-0">{{ result.final_score }} / {{ total_possible_score }} միավոր</p>
                        </div>
                        
                        <div class="p-4">
                            <div class="row align-items-center mb-5">
                                <div class="col-md-5 text-center">
                                    <div class="score-display">
                                        <div class="score-circle" style="--percentage: {{ result.percentage }}%;">
                                            <div class="score-value">{{ result.percentage }}<sup>%</sup></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-7">
                                    <div class="character-result text-center text-md-start">
                                        {% if result.character_result == "ara" %}
                                            <div class="character-banner d-flex align-items-center mb-3">
                                                <img src="{% static 'img/ara.jpg' %}" alt="Արա Գեղեցիկ" class="character-image">
                                                <div class="ms-3">
                                                    <h3 class="character-name mb-1">Արա Գեղեցիկ</h3>
                                                    <div class="badge bg-success px-3 py-2">Կիբեռգիտակ</div>
                                                </div>
                                            </div>
                                        {% else %}
                                            <div class="character-banner d-flex align-items-center mb-3">
                                                <img src="{% static 'img/shamiram.jpg' %}" alt="Շամիրամ" class="character-image">
                                                <div class="ms-3">
                                                    <h3 class="character-name mb-1">Շամիրամ</h3>
                                                    <div class="badge bg-warning text-dark px-3 py-2">Կիբեռսովորող</div>
                                                </div>
                                            </div>
                                        {% endif %}
                                        
                                        <p class="feedback-message">{{ result.feedback_message }}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="achievement-section bg-light p-4 rounded mb-4">
                                <h4 class="mb-4"><i class="fas fa-star text-warning me-2"></i>Ձեր ձեռքբերումները</h4>
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <div class="achievement-card text-center p-3 bg-white rounded shadow-sm">
                                            <i class="fas fa-brain fa-2x text-primary mb-2"></i>
                                            <h5>Կիբեռ Մտածող</h5>
                                            <p class="small text-muted mb-0">Հաջողությամբ անցաք քուիզը</p>
                                        </div>
                                    </div>
                                    
                                    {% if result.percentage >= 50 %}
                                    <div class="col-md-4">
                                        <div class="achievement-card text-center p-3 bg-white rounded shadow-sm">
                                            <i class="fas fa-shield-alt fa-2x text-success mb-2"></i>
                                            <h5>Կիբեռ Պաշտպան</h5>
                                            <p class="small text-muted mb-0">Ավելի քան 50% ճիշտ</p>
                                        </div>
                                    </div>
                                    {% endif %}
                                    
                                    {% if result.percentage >= 80 %}
                                    <div class="col-md-4">
                                        <div class="achievement-card text-center p-3 bg-white rounded shadow-sm">
                                            <i class="fas fa-medal fa-2x text-warning mb-2"></i>
                                            <h5>Կիբեռ Մաստեր</h5>
                                            <p class="small text-muted mb-0">Ավելի քան 80% ճիշտ</p>
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="recommendations mb-4">
                                <h4 class="mb-3"><i class="fas fa-lightbulb text-primary me-2"></i>Խորհուրդներ</h4>
                                <div class="card">
                                    <div class="card-body">
                                        <ul class="mb-0">
                                            {% if result.percentage < 70 %}
                                            <li class="mb-2">Ուսումնասիրեք կիբեռանվտանգության հիմնական սկզբունքները</li>
                                            <li class="mb-2">Փորձեք ճանաչել ֆիշինգային սպառնալիքները</li>
                                            <li class="mb-2">Կարդացեք մեր ուղեցույցը ուժեղ գաղտնաբառերի մասին</li>
                                            {% else %}
                                            <li class="mb-2">Ապրե՛ս, շարունակեք ամրապնդել ձեր գիտելիքները</li>
                                            <li class="mb-2">Կիսվեք ձեր գիտելիքներով ընկերների հետ</li>
                                            <li class="mb-2">Փորձեք հաջորդ մակարդակի քուիզը</li>
                                            {% endif %}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="result-actions text-center">
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <a href="{% url 'quiz:home' %}" class="btn btn-primary w-100">
                                            <i class="fas fa-redo me-2"></i> Նոր Քուիզ
                                        </a>
                                    </div>
                                    
                                    <div class="col-md-4 mb-3">
                                        {% if result.character_result == "shamiram" %}
                                        <a href="/learn/phishing" class="btn btn-warning w-100">
                                            <i class="fas fa-book me-2"></i> Սովորել Ավելին
                                        </a>
                                        {% else %}
                                        <a href="/share" class="btn btn-success w-100">
                                            <i class="fas fa-share-alt me-2"></i> Կիսվել Արդյունքով
                                        </a>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="col-md-4 mb-3">
                                        <a href="{% url 'quiz:leaderboard' %}" class="btn btn-info w-100">
                                            <i class="fas fa-trophy me-2"></i> Լավագույն Արդյունքներ
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animation for score circle on page load
    setTimeout(() => {
        document.querySelector('.score-circle').style.transition = 'all 1.5s ease';
        document.querySelector('.score-circle').style.setProperty('--percentage', '{{ result.percentage }}%');
    }, 300);
    
    // Add confetti effect for high scores
    if ({{ result.percentage }} >= 70) {
        createConfetti();
    }
    
    function createConfetti() {
        const confettiCount = 200;
        const confettiColors = ['#3498db', '#2ecc71', '#e74c3c', '#f1c40f', '#9b59b6'];
        const confettiContainer = document.createElement('div');
        confettiContainer.style.position = 'fixed';
        confettiContainer.style.top = '0';
        confettiContainer.style.left = '0';
        confettiContainer.style.width = '100%';
        confettiContainer.style.height = '100%';
        confettiContainer.style.pointerEvents = 'none';
        confettiContainer.style.zIndex = '9999';
        document.body.appendChild(confettiContainer);
        
        for (let i = 0; i < confettiCount; i++) {
            setTimeout(() => {
                const confetti = document.createElement('div');
                const color = confettiColors[Math.floor(Math.random() * confettiColors.length)];
                const size = Math.random() * 10 + 5;
                const xPos = Math.random() * window.innerWidth;
                
                confetti.style.position = 'absolute';
                confetti.style.left = xPos + 'px';
                confetti.style.top = '-20px';
                confetti.style.width = size + 'px';
                confetti.style.height = size + 'px';
                confetti.style.backgroundColor = color;
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                confetti.style.opacity = Math.random() + 0.5;
                
                confettiContainer.appendChild(confetti);
                
                const animationDuration = Math.random() * 3 + 2;
                const xMove = (Math.random() - 0.5) * 200;
                
                confetti.animate([
                    { transform: 'translateY(0) rotate(0)', opacity: 1 },
                    { transform: `translateY(${window.innerHeight}px) translateX(${xMove}px) rotate(${Math.random() * 360}deg)`, opacity: 0 }
                ], {
                    duration: animationDuration * 1000,
                    easing: 'ease-in'
                });
                
                setTimeout(() => confetti.remove(), animationDuration * 1000);
            }, Math.random() * 1500);
        }
    }
    
    // Social sharing functionality
    document.querySelectorAll('.share-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            const network = this.getAttribute('data-network');
            const shareText = `Ես ստացել եմ ${result.percentage}% միավոր կիբեռանվտանգության քուիզում! Փորձի՛ր դու ևս:`;
            const shareUrl = window.location.href;
            
            let shareWindow;
            
            switch(network) {
                case 'facebook':
                    shareWindow = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}&quote=${encodeURIComponent(shareText)}`;
                    break;
                case 'twitter':
                    shareWindow = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(shareUrl)}`;
                    break;
                case 'linkedin':
                    shareWindow = `https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(shareUrl)}&title=${encodeURIComponent('Կիբեռանվտանգության Քուիզ')}&summary=${encodeURIComponent(shareText)}`;
                    break;
                case 'telegram':
                    shareWindow = `https://t.me/share/url?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(shareText)}`;
                    break;
            }
            
            window.open(shareWindow, '_blank', 'width=600,height=400');
        });
    });
});
</script>
{% endblock %}