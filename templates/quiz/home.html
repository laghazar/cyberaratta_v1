
{% extends 'base.html' %}
{% load static %}

{% block title %}’é’´’Ø’ø’∏÷Ä’´’∂’° - CyberAratta{% endblock %}

{% block page_title %}üß† ‘ø’´’¢’•’º’°’∂’æ’ø’°’∂’£’∏÷Ç’©’µ’°’∂ ’é’´’Ø’ø’∏÷Ä’´’∂’°{% endblock %}

{% block page_subtitle %}
<p class="lead text-center mb-5">’ì’∏÷Ä’±’°÷Ä’Ø’•÷Ñ ’Å’•÷Ä ’£’´’ø’•’¨’´÷Ñ’∂’•÷Ä’® ’Ø’´’¢’•’º’°’∂’æ’ø’°’∂’£’∏÷Ç’©’µ’°’∂ ’æ’•÷Ä’°’¢’•÷Ä’µ’°’¨</p>
{% endblock %}

{% block content %}
<div class="container">
    {% if error %}
    <div class="alert alert-error alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-triangle me-2"></i>
        {{ error }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="’ì’°’Ø’•’¨"></button>
    </div>
    {% endif %}
    
    <form method="post" action="{% url 'quiz:start_quiz' %}" id="quiz-form">
        {% csrf_token %}
        
        <!-- Category Selection -->
        <div class="cyber-card mb-4">
            <div class="cyber-card-header">
                <h4><i class="fas fa-list me-2"></i>‘∏’∂’ø÷Ä’•÷Ñ ‘ø’°’ø’•’£’∏÷Ä’´’°’∂</h4>
            </div>
            <div class="cyber-card-body">
                <div class="row">
                    {% for category in categories %}
                    <div class="col-md-4 mb-3">
                        <div class="quiz-category-card h-100" data-category="{{ category.id }}" tabindex="0">
                            <div class="card-body text-center p-4">
                                {% if category.category_type == 'school' %}
                                    <i class="fas fa-school fa-3x text-primary mb-3"></i>
                                {% elif category.category_type == 'student' %}
                                    <i class="fas fa-user-graduate fa-3x text-info mb-3"></i>
                                {% else %}
                                    <i class="fas fa-briefcase fa-3x text-success mb-3"></i>
                                {% endif %}
                                <h5 class="card-title mb-3">{{ category.name }}</h5>
                                <p class="card-text text-muted">{{ category.description|default:"‘∏’∂’ø÷Ä’•÷Ñ ’°’µ’Ω ’Ø’°’ø’•’£’∏÷Ä’´’°’∂" }}</p>
                                <input type="radio" name="category" value="{{ category.id }}" id="cat_{{ category.id }}" style="display:none;">
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <!-- Question Type Selection -->
        <div class="cyber-card mb-4">
            <div class="cyber-card-header">
                <h4><i class="fas fa-question-circle me-2"></i>‘∏’∂’ø÷Ä’•÷Ñ ’Ä’°÷Ä÷Å’´ ’è’•’Ω’°’Ø’®</h4>
            </div>
            <div class="cyber-card-body">
                <div class="row">
                    {% for value, display in Question.QUESTION_TYPES %}
                    <div class="col-md-6 mb-3">
                        <div class="quiz-type-card h-100" data-type="{{ value }}">
                            <div class="card-body text-center p-4">
                                {% if value == 'classic' %}
                                    <i class="fas fa-tasks fa-3x text-success mb-3"></i>
                                    <h5 class="card-title mb-3">{{ display }}</h5>
                                    <p class="card-text text-muted">’à÷Ç’Ω’∏÷Ç÷Å’∏’≤’°’Ø’°’∂ ÷Ñ’∏÷Ç’´’¶ ’Æ’°’∂’∏÷Ç÷Å’∏÷Ç’¥’∂’•÷Ä’∏’æ ÷á ’¢’°÷Å’°’ø÷Ä’∏÷Ç’©’µ’∏÷Ç’∂’∂’•÷Ä’∏’æ</p>
                                {% else %}
                                    <i class="fas fa-crown fa-3x text-warning mb-3"></i>
                                    <h5 class="card-title mb-3">{{ display }}</h5>
                                    <p class="card-text text-muted">‘Ω’°’≤’°’µ’´’∂ ’±÷á’°’π’°÷É ’™’°’¥’°’∂’°’Ø’´ ’Ω’°’∞’¥’°’∂’°÷É’°’Ø’¥’°’¥’¢</p>
                                {% endif %}
                                <input type="radio" name="question_type" value="{{ value }}" id="type_{{ value }}" style="display:none;">
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <div class="text-center">
            <button type="submit" class="btn btn-cyber btn-lg px-5">
                <i class="fas fa-play me-2"></i>’ç’Ø’Ω’•’¨ ’é’´’Ø’ø’∏÷Ä’´’∂’°
            </button>
            <a href="{% url 'quiz:leaderboard' %}" class="btn btn-outline-primary btn-lg px-5 ms-3">
                <i class="fas fa-trophy me-2"></i>‘º’°’æ’°’£’∏÷Ç’µ’∂ ‘±÷Ä’§’µ’∏÷Ç’∂÷Ñ’∂’•÷Ä
            </a>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('Quiz page loaded, initializing selection handlers...');
    
    // ‘ø’°’ø’•’£’∏÷Ä’´’°’∂’•÷Ä’´ ’®’∂’ø÷Ä’∏÷Ç’©’µ’∏÷Ç’∂
    const categoryCards = document.querySelectorAll('.quiz-category-card');
    console.log('Found', categoryCards.length, 'category cards');
    
    categoryCards.forEach((card, index) => {
        card.addEventListener('click', function() {
            console.log('Category card clicked:', this.dataset.category);
            
            // Remove active class from all cards
            categoryCards.forEach(c => c.classList.remove('active'));
            // Add active class to clicked card
            this.classList.add('active');
            
            // Check the radio button
            const categoryId = this.dataset.category;
            const radioButton = document.getElementById('cat_' + categoryId);
            if (radioButton) {
                radioButton.checked = true;
                console.log('Radio button checked for category:', categoryId);
            } else {
                console.error('Radio button not found for category:', categoryId);
            }
        });
    });
    
    // ’Ä’°÷Ä÷Å’•÷Ä’´ ’ø’•’Ω’°’Ø’´ ’®’∂’ø÷Ä’∏÷Ç’©’µ’∏÷Ç’∂
    const typeCards = document.querySelectorAll('.quiz-type-card');
    console.log('Found', typeCards.length, 'type cards');
    
    typeCards.forEach(card => {
        card.addEventListener('click', function() {
            console.log('Type card clicked:', this.dataset.type);
            
            // Remove active class from all cards
            typeCards.forEach(c => c.classList.remove('active'));
            // Add active class to clicked card
            this.classList.add('active');
            
            // Check the radio button
            const typeValue = this.dataset.type;
            const radioButton = document.getElementById('type_' + typeValue);
            if (radioButton) {
                radioButton.checked = true;
                console.log('Radio button checked for type:', typeValue);
            } else {
                console.error('Radio button not found for type:', typeValue);
            }
        });
    });
    
    // Keyboard navigation
    const allCards = document.querySelectorAll('.quiz-category-card, .quiz-type-card');
    allCards.forEach(card => {
        card.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                this.click();
            }
        });
    });
    
    // Form submission validation
    const quizForm = document.getElementById('quiz-form');
    if (quizForm) {
        quizForm.addEventListener('submit', function(e) {
            const categoryChecked = document.querySelector('input[name="category"]:checked');
            const typeChecked = document.querySelector('input[name="question_type"]:checked');
            
            console.log('Form submitted. Category checked:', !!categoryChecked, 'Type checked:', !!typeChecked);
            
            if (!categoryChecked) {
                e.preventDefault();
                alert('‘Ω’∂’§÷Ä’∏÷Ç’¥ ’•’∂÷Ñ ’®’∂’ø÷Ä’•’¨ ’Ø’°’ø’•’£’∏÷Ä’´’°’∂');
                return false;
            }
            
            if (!typeChecked) {
                e.preventDefault();
                alert('‘Ω’∂’§÷Ä’∏÷Ç’¥ ’•’∂÷Ñ ’®’∂’ø÷Ä’•’¨ ’∞’°÷Ä÷Å’´ ’ø’•’Ω’°’Ø’®');
                return false;
            }
            
            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>‘≤’•’º’∂’æ’∏÷Ç’¥ ’ß...';
            submitBtn.disabled = true;
        });
    } else {
        console.error('Quiz form not found!');
    }
});
</script>
{% endblock %}